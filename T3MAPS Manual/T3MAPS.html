<html><head><title>T3MAPS</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}.c38{border-bottom-width:1pt;border-top-style:solid;width:26.4pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c30{border-bottom-width:1pt;border-top-style:solid;width:24.7pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c36{border-bottom-width:1pt;border-top-style:solid;width:38.4pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c35{border-bottom-width:1pt;border-top-style:solid;width:39.8pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c7{border-bottom-width:1pt;border-top-style:solid;width:97.5pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c25{border-bottom-width:1pt;border-top-style:solid;width:49.5pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c18{border-bottom-width:1pt;border-top-style:solid;width:54pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c23{border-bottom-width:1pt;border-top-style:solid;width:60.8pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c11{border-bottom-width:1pt;border-top-style:solid;width:252pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c31{border-bottom-width:1pt;border-top-style:solid;width:41.2pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c9{border-bottom-width:1pt;border-top-style:solid;width:128.2pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c34{border-bottom-width:1pt;border-top-style:solid;width:27.1pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c28{border-bottom-width:1pt;border-top-style:solid;width:27pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c22{border-bottom-width:1pt;border-top-style:solid;width:66pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c13{border-bottom-width:1pt;border-top-style:solid;width:51pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c37{border-bottom-width:1pt;border-top-style:solid;width:39.7pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c21{border-bottom-width:1pt;border-top-style:solid;width:82.5pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c12{border-bottom-width:1pt;border-top-style:solid;width:214.5pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c19{border-bottom-width:1pt;border-top-style:solid;width:27.7pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c3{vertical-align:baseline;color:#000000;font-size:11pt;font-style:normal;font-family:"Arial";text-decoration:none;font-weight:normal}.c27{vertical-align:baseline;font-size:11pt;font-style:normal;font-family:"Arial";text-decoration:none;font-weight:normal}.c0{widows:2;orphans:2;height:11pt;direction:ltr}.c2{line-height:1.0;padding-top:0pt;text-align:left;padding-bottom:0pt}.c17{line-height:1.15;padding-top:0pt;text-align:justify;padding-bottom:0pt}.c8{line-height:1.15;padding-top:0pt;text-align:center;padding-bottom:0pt}.c1{widows:2;orphans:2;direction:ltr}.c32{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c33{margin-right:auto;border-collapse:collapse}.c10{color:#ff0000;font-weight:bold}.c6{font-size:12pt;font-weight:bold}.c15{font-size:18pt;font-weight:bold}.c16{color:#ff0000}.c5{font-size:30pt}.c4{height:0pt}.c20{height:24pt}.c26{font-weight:bold}.c29{font-size:14pt}.c24{text-align:center}.c14{text-align:left}.title{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}.subtitle{widows:2;padding-top:0pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt;page-break-after:avoid}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h2{widows:2;padding-top:10pt;line-height:1.15;orphans:2;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h3{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt;page-break-after:avoid}h4{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h5{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}h6{widows:2;padding-top:8pt;line-height:1.15;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt;page-break-after:avoid}</style></head><body class="c32"><p class="c1"><span class="c5">T3MAPS Operation Note</span></p><p class="c1"><span><br>This document describes the bitStream pattern of the T3MAPS command. It is directly translated from Brad Axen&rsquo;s pix.py. Our goal is to understand each bit stream for the T3MAPS operation T3MAPS in order to develop an efficient DAQ system to control it. The document is organized as follow: Section 1 describes the basic command structure, Section 2 describes the procedure of calibration scans.</span></p><p class="c0"><span></span></p><p class="c1"><span class="c15">1 Commands:</span></p><p class="c0"><span class="c26 c29"></span></p><p class="c1"><span class="c26 c29">1.1 Data Generator Block:</span></p><p class="c0"><span></span></p><p class="c1"><span>The commands are sent out to T3MAPS as data Blocks from the data Generator, each block composed of:</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 148.00px;"><img alt="" src="images/image01.png" style="width: 624.00px; height: 148.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Figure 1</span></p><p class="c1"><span>&nbsp;</span></p><p class="c1"><span>1: Start Block: 50 bits of &lsquo;0&rsquo;</span></p><p class="c1"><span>2+3+4: Configuration Block</span></p><p class="c1"><span>5: End Block: 100 bits of &lsquo;0&rsquo;</span></p><p class="c0"><span></span></p><p class="c1"><span>2: Config0: 10 bits of &lsquo;0&rsquo;</span></p><p class="c1"><span>3: Acual Command sent(Command number of bits, for instance, set_config is 32+144=176 bits)</span></p><p class="c1"><span>4: End Config Block: What ever number of &lsquo;0&rsquo;s left in configuration size(for instance. set_config has a configuration size of 800, therefore End Config Block size is 800-176-10=614)</span></p><p class="c1"><span>&nbsp;</span></p><p class="c1"><span>All &lsquo;0&rsquo;s are issued to ensure safe transmission of the data, but since we use FIFO, this is not a problem</span></p><p class="c1"><span>Each bit is repeated for ClockUnitDuration of times(This is used for data generator internal bit duration)</span></p><p class="c0"><span></span></p><p class="c1"><span>For our purpose, we only care about block 3, hence we will focus only on block3, which is the actual command block</span></p><p class="c0"><span class="c15"></span></p><p class="c1"><span class="c26 c29">1.2 Command Construction:</span></p><p class="c0"><span class="c26 c29"></span></p><p class="c1"><span>Commands have two types, configuration command and column command</span></p><p class="c1"><span>There are two types of shift_registers, configuration shift register(set configurations) and pixel shift register(write values to pixels)</span></p><p class="c0"><span></span></p><p class="c1"><span>configuration command only writes to the configuration shift register</span></p><p class="c1"><span>column command write to both configuration shift register and pixel shift register</span></p><p class="c0"><span></span></p><p class="c1"><span class="c6">1) Configuration command(set_config):</span></p><p class="c1"><span>Composed of two parts: Configuration bits(32)+DAC configuration bits(144, </span><span class="c16">is this the shadow register?</span><span>)</span></p><p class="c1"><span class="c26">Configuration bits(Column Configuration):</span></p><p class="c1"><span>called during set_config to initialize the configuration, later it is managed by Column command in order to send specific command to columns</span></p><p class="c1"><span class="c26">DAC configuration bits:</span></p><p class="c1"><span>called only once during the configuration by the set_config command, and never changed afterwards</span></p><p class="c0"><span></span></p><p class="c1"><span>For configuration command, four pins on T3MAPS are managed in this process:</span></p><p class="c0"><span></span></p><p class="c1"><span>- SRIN_ALL(Shift Register In for All): to send the actual command</span></p><p class="c1"><span>- Dacld (DAC Load): A pulse on this pin loads the remaining 144 bits of the configuration register, i.e. loads the DAC configuration bits</span></p><p class="c1"><span>- GCfgCK (Global Configuration Clock): Clock for the Configuration shift Register</span></p><p class="c1"><span>- Stbld (Strobe Load): A pulse on this pin loads the first 32 bits of the configuration register, i.e. loads the configuration bits </span></p><p class="c0"><span></span></p><p class="c1"><span>example of such graph for set_config command:</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 464.00px;"><img alt="figure_1.png" src="images/image04.png" style="width: 624.00px; height: 464.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Figure 2</span></p><p class="c0"><span></span></p><p class="c1"><span class="c6">2) Column command:</span></p><p class="c1"><span>In order to write a column command, one has to:</span></p><p class="c0"><span></span></p><p class="c1"><span>(1) Point to the Column wish to write to by managing the configuration bits(i.e. send a configuration command with only the top 32 bits)</span></p><p class="c1"><span>(2) Enable Load Pixel Register(still configuration command for top 32 bits)</span></p><p class="c1"><span>(2) Write pixel configuration values to the pixel register(i.e. hit_or, hit, inject, DAC setting)</span></p><p class="c1"><span>(3) Disable Load Pixel Register(configuration command for top 32 bits)</span></p><p class="c0"><span></span></p><p class="c1"><span>5 pins on T3MAPS are managed in this process:</span></p><p class="c1"><span>SRIN_ALL:(Shift Register In for All)</span></p><p class="c1"><span>Stbld: A pulse on this pin loads the first 32 bits of the configuration register, i.e. loads the configuration bits </span></p><p class="c1"><span>Dacld: A pulse on this pin loads the remaining 144 bits of the configuration register, i.e. loads the DAC configuration bits</span></p><p class="c1"><span>GCfgCK: Clock for the </span><span class="c10">Configuration shift Register</span></p><p class="c1"><span>SRCK_G: Clock for </span><span class="c10">Pixel shift Register</span></p><p class="c1"><span class="c10">Because they use different clocks, this is how you use a single pin for All shift registers, but can choose to send command to configuration register or pixel register</span></p><p class="c0"><span></span></p><p class="c1"><span class="c26 c29">1.3 Shift Register Layout:</span></p><p class="c0"><span class="c26"></span></p><p class="c1"><span class="c26">&#65288;1&#65289;Configuration Shift Register</span></p><p class="c0"><span class="c26"></span></p><p class="c0"><span class="c26"></span></p><p class="c0"><span class="c26"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 126.94px;"><img alt="" src="images/image02.png" style="width: 624.00px; height: 126.94px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Figure 3</span></p><p class="c0 c14"><span></span></p><p class="c1 c14"><span class="c26">1) Pixel Configuration:</span></p><p class="c0 c14"><span></span></p><p class="c0 c24"><span></span></p><a href="#" name="d038fbed9814a60316e139864300f8c5a11bceb2"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c33"><tbody><tr class="c4"><td class="c28"><p class="c8 c1"><span class="c3">31</span></p></td><td class="c28"><p class="c1 c8"><span class="c3">30</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">29</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">28</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">27</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">26</span></p></td><td class="c31"><p class="c8 c1"><span class="c3">25-24</span></p></td><td class="c35"><p class="c1 c17"><span class="c3">23-22</span></p></td><td class="c22"><p class="c8 c1"><span class="c3">21-14</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">13</span></p></td><td class="c28"><p class="c8 c1"><span class="c3">12</span></p></td><td class="c38"><p class="c8 c1"><span class="c3">11</span></p></td><td class="c37"><p class="c8 c1"><span class="c3">10 - 6</span></p></td><td class="c36"><p class="c8 c1"><span class="c3">5 - 0</span></p></td></tr></tbody></table><p class="c1 c24"><span>Figure 4</span></p><p class="c0"><span class="c26"></span></p><a href="#" name="eb0cf7cdfebb093b2bf32490e876b5d8e09a66d7"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c33"><tbody><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">Bit</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">Name </span></p></td><td class="c23"><p class="c2 c1"><span class="c3">Default Value</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">Comments</span></p></td></tr><tr class="c20"><td class="c21"><p class="c2 c1"><span class="c3">31</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">global_readout_enable</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">active high readout enable for all pixels</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">30</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">SRDO_load</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">shift register data out load</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">29</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">NCout2</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c27 c16">??</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">28</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">count_hits_not</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c27 c16">active low count_hits?</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">27</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">count_enable</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c27 c16">active high count_enable?</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">26</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">count_clear_not</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c27 c16">active low count_clear?</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">25-24</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">S1,S0</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">00</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">Strobe mode, simillar to FEI4, S0 = S1 = 0 means normal shift mode, shift in on clock rising edge and out on falling edge (this is the only one we use)</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">23-22</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">config_mode</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">00</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">as explained in the FEI4 manual, config_mode[1][0] controls how the pixels are written, if config_mode = &ldquo;00&rdquo;(by default), this is to write only to the pixel addressed(single pixel mode) if config_mode = &ldquo;11&rdquo;, this is to write to all columns</span></p><p class="c0 c2"><span class="c3"></span></p><p class="c2 c1"><span class="c3">note to use config mode &ldquo;11&rdquo; you have to point the shift register back to column0 first</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">21-14</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">config_bits</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">00000000</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">21: active high hit_or_enable</span></p><p class="c2 c1"><span class="c3">20: active high hit</span></p><p class="c2 c1"><span class="c3">19: active high inject</span></p><p class="c2 c1"><span class="c3">18-14: 5 bit TDAC</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">13</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">lden(LDENABLE_SEL)</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">Active high load enable configuration bits(8 bits above), similar concept in FEI4 is latch enable</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">12</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">SRCLR_SEL</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c16 c27">Shift Register Clear?</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">11</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">HITLD_IN</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">works with s1, s0 to enable different modes</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">10 - 6</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">NCout 21_25</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">00000</span></p></td><td class="c12"><p class="c2 c1"><span class="c27 c16">Number of Counts?</span></p></td></tr><tr class="c4"><td class="c21"><p class="c2 c1"><span class="c3">5 - 0</span></p></td><td class="c9"><p class="c2 c1"><span class="c3">column address</span></p></td><td class="c23"><p class="c2 c1"><span class="c3">111111</span></p></td><td class="c12"><p class="c2 c1"><span class="c3">Which column to write to</span></p></td></tr></tbody></table><p class="c1 c24"><span>Table 1</span></p><p class="c0"><span></span></p><p class="c1"><span class="c26">2) DAC configuration:</span></p><p class="c0"><span></span></p><p class="c0 c24"><span></span></p><a href="#" name="1a8c420ae9ef8b57519810babd2b0ada1e47eb2c"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c33"><tbody><tr class="c4"><td class="c19"><p class="c8 c1"><span class="c3">17</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">16</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">15</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">14</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">13</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">12</span></p></td><td class="c34"><p class="c8 c1"><span class="c3">11</span></p></td><td class="c19"><p class="c8 c1"><span class="c3">10</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">9</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">8</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">7</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">6</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">5</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">4</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">3</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">2</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">1</span></p></td><td class="c30"><p class="c8 c1"><span class="c3">0</span></p></td></tr></tbody></table><p class="c1 c24"><span>Figure 5</span></p><p class="c0 c24"><span></span></p><a href="#" name="23da1f8ddc5346a2c95ac5b08a9723b36f91c6d4"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c33"><tbody><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">Number</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">Bit</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">Name </span></p></td><td class="c7"><p class="c2 c1"><span class="c3">Default Value</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">Comments</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">17</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">143-136</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">10000001</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">default=10000001 (129 in binary)</span></p></td></tr><tr class="c4"><td class="c18"><p class="c1 c2"><span class="c3">16</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">135-128</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">15</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">127-120</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">14</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">119-112</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">13</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">111-104</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">DisVbn</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">00110001(49 in binary)</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">Discriminator voltage bias</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">12</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">103-96</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">11</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">95-88</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">10</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">87-80</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">9</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">79-72</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">8</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">71-64</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">7</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">63-56</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">6</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">55-48</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">VbpThStep</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">01100100(100 in binary)</span></p></td><td class="c11"><p class="c2 c1"><span class="c27 c16">Simillar to FEI4-b v2.3 manual p28, VbpStep, Used for TDAC??</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">5</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">47-40</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">PrmpVbp</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">10001110(142 in binary)</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">Main preamp voltage bias</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">4</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">39-32</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">PrmpVbnFol</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">00100011(35 in binary)</span></p><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c2 c1"><span class="c3">First Stage follower Voltage bias</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">3</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">31-24</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">Vth</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">10010110(150 in binary)</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">Voltage threshold</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">2</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">23-16</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">PrmpVbf</span></p></td><td class="c7"><p class="c2 c1"><span class="c3">00001011(11 in binary)</span></p></td><td class="c11"><p class="c2 c1"><span class="c3">master feedback current of Preamp</span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">1</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">15-8</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr><tr class="c4"><td class="c18"><p class="c2 c1"><span class="c3">0</span></p></td><td class="c13"><p class="c2 c1"><span class="c3">7-0</span></p></td><td class="c25"><p class="c2 c1"><span class="c3">default</span></p></td><td class="c7"><p class="c0 c2"><span class="c3"></span></p></td><td class="c11"><p class="c0 c2"><span class="c3"></span></p></td></tr></tbody></table><p class="c1 c24"><span>Table 2</span></p><p class="c0 c24"><span></span></p><p class="c1 c14"><span class="c26">(2) Pixel Shift Register:</span></p><p class="c1 c14"><span>The length of pixel shift register is 64, which matches to the number of pixels per column, hence each bit represent the pixel it is pointing to</span></p><p class="c0 c14"><span></span></p><p class="c1 c14"><span>for example, if we want to enable hit_or in row 8, column 10</span></p><p class="c1 c14"><span>Then we need to issue three commands</span></p><p class="c1 c14"><span>(1) Configuration Command: config_bits = 10000000, only enable hit_or, this will tell the pixel shift register that you are going to write to hit_or, column_adress = 001010(binary of 10), lden=1(This is to enable the load for configuration bits), other parameter use defaults</span></p><p class="c1 c14"><span>(2) Column Command: all 1s except 0 to bit 7(Counting from LSB, Start from 0),(since hit_or is active low)</span></p><p class="c1 c14"><span>(3) Configuration Command: lden=0(disable configuration load), column_adress = 000000(point column back to the 0th), other parameter use defaults</span></p><p class="c0 c14"><span></span></p><p class="c0 c14"><span></span></p><p class="c1"><span class="c16 c5">What we want to know</span><span class="c5">:</span></p><p class="c1"><span>However, we need to know the meaning of many of the variables for instance, default, and why it&rsquo;s value is 129. Also, if some of our assumption is correct</span></p><p class="c0"><span></span></p><p class="c1"><span>Max - We also would like a more low level schematic - the simulation of the columns, or the transistor layout of the chip. We need to figure out how to use the Dout bus, vs. hitor. Because of this, we need to re-implement the code to enable the correct settings. For instance, we would probably need to disable hitor? Also it would be great to get an explanation of how the data from the shift register is transferred to the pixel and configuration registers, something that I still don&rsquo;t quite understand. </span></p><p class="c0"><span></span></p><p class="c1"><span>We would like to redesign the software to work with our hardware, from the ground up. </span></p><p class="c1"><span>Hacking together a solution would work, but is ugly and prone to failure. By building our own software, we will be able to move many time consuming functions into FPGA fabric.</span></p><p class="c1"><span>Below is what we thing the configuration register map bit layout looks like.</span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c1"><span class="c15">2 Calibration Scan:</span></p><p class="c1"><span><br>This section describes the procedure of a list of calibration scans for T3MAPS implemented in Brad&rsquo;s python script. Analog test, Threshold tuning and Threshold scan. The charge injection are deployed by using an external pulse generator. The output is just read out using hitOr pin with a data counter. We can only scan one pixel at a time due to this operation mode.</span></p><p class="c0"><span></span></p><p class="c1"><span class="c16">Q: how can we read out T3MAPS with multiple pixels in parallel?</span><span>&nbsp;</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 829.33px;"><img alt="scan_digital_1.png" src="images/image00.png" style="width: 624.00px; height: 829.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Pic 1</span></p><p class="c1 c24"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 829.33px;"><img alt="scan_digital_2.png" src="images/image03.png" style="width: 624.00px; height: 829.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>Pic 2</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 829.33px;"><img alt="scan_digital_3.png" src="images/image05.png" style="width: 624.00px; height: 829.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Pic 3</span></p><p class="c1 c24"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 829.33px;"><img alt="scan_digital_4.png" src="images/image06.png" style="width: 624.00px; height: 829.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c24"><span>Pic 4</span></p><p class="c1"><span>Email discussion documentation: </span></p><p class="c0"><span></span></p><p class="c1"><span>From what we discussed over email, we clarified that by using the pixel configuration register in combination with the column address which is part of this register, you can individually set the configuration of each pixel in T3MAPS, column by column. The confusion resulted from a misunderstanding of how the 8 bit pixel level registers worked. The data for these register lies in the pixel configuration register, under config bits. Since different clocks are used to configure each register, only one pin is needed. </span></p></body></html>